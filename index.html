<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ | Ù…Ø­Ù…Ø¯ - Ø¢Ø³ÙŠØ© - Ø³Ù„Ø³Ø¨ÙŠÙ„</title>
  <style>
    :root{
      --bg1:#f7fbff;
      --bg2:#fff7fb;
      --card:#ffffffcc;
      --ink:#0b1b2b;
      --muted:#5b6b7a;
      --primary:#2b7cff;
      --primary2:#6c3bff;
      --good:#1aa36f;
      --bad:#ff4d5a;
      --warn:#ffb020;
      --shadow: 0 18px 40px rgba(15,35,55,.12);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 20% 10%, #dff1ff 0%, transparent 60%),
        radial-gradient(900px 650px at 80% 20%, #f4ddff 0%, transparent 60%),
        radial-gradient(900px 650px at 40% 90%, #ffe6ef 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .app{width:min(1040px, 100%)}
    .topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      box-shadow: var(--shadow);
      display:grid;place-items:center;color:white;font-weight:900;
    }
    .brand h1{margin:0;font-size:18px;line-height:1.2}
    .brand .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .pill{
      background: #ffffffb0;
      border:1px solid rgba(20,40,60,.08);
      padding:10px 12px;
      border-radius:999px;
      box-shadow: 0 10px 24px rgba(15,35,55,.08);
      display:flex;gap:10px;align-items:center;color:var(--muted);
      font-size:13px;flex-wrap:wrap
    }
    .grid{display:grid;grid-template-columns: 1.15fr .85fr;gap:16px}
    @media (max-width: 900px){.grid{grid-template-columns:1fr}}

    .card{
      background: var(--card);
      border: 1px solid rgba(20,40,60,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card .hd{padding:18px 18px 10px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .card .hd h2{margin:0;font-size:18px}
    .card .hd p{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.6}
    .card .bd{padding:14px 18px 18px}

    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:0;border-radius: 14px;padding:12px 14px;
      font-weight:900;cursor:pointer;transition: transform .08s ease, filter .2s ease;
      font-size:14px;
    }
    button:active{transform: translateY(1px) scale(.99)}
    .btn-primary{
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:white;
      box-shadow: 0 14px 26px rgba(43,124,255,.25);
    }
    .btn-ghost{
      background:#ffffffc8;
      border:1px solid rgba(20,40,60,.12);
      color:var(--ink);
    }
    .btn-danger{
      background: linear-gradient(135deg, #ff4d5a, #ff7a3d);
      color:white;
      box-shadow: 0 14px 26px rgba(255,77,90,.22);
    }

    .badge{
      font-size:12px;padding:6px 10px;border-radius:999px;
      background: #eef5ff;border:1px solid rgba(43,124,255,.15);
      color:#1b4aa8;font-weight:1000;white-space:nowrap;
    }
    .mutebadge{background:#f7f7f9;border:1px solid rgba(20,40,60,.10);color:var(--muted)}

    /* Controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .seg{
      display:flex;gap:6px;align-items:center;
      padding:8px;border-radius:16px;
      background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
      flex-wrap:wrap;
    }
    .seg label{font-size:12px;color:var(--muted);font-weight:1000;margin-inline:6px}
    .seg button{padding:10px 12px;border-radius:12px;font-size:13px}
    .seg .active{
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:#fff;
      border:0;
    }

    /* Characters */
    .chars{display:grid;grid-template-columns: repeat(3, 1fr);gap:12px;margin-top:10px}
    @media (max-width: 560px){.chars{grid-template-columns:1fr}}
    .char{
      border-radius: 18px;border:1px solid rgba(20,40,60,.10);
      background:#ffffffb8;padding:12px;display:flex;gap:10px;align-items:center;
      cursor:pointer;user-select:none;
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
      overflow: hidden; /* important: keep layout clean */
    }
    .char:hover{transform: translateY(-2px);box-shadow: 0 16px 34px rgba(15,35,55,.12);filter:saturate(1.05)}
    .avatar{
      width:56px;height:56px;border-radius:18px;display:grid;place-items:center;
      background: radial-gradient(circle at 30% 20%, #fff 0%, #f2f7ff 55%, #eaf0ff 100%);
      border:1px solid rgba(20,40,60,.10);overflow:hidden;flex:0 0 auto;
    }
    .meta{
      display:flex;flex-direction:column;
      min-width:0; /* FIX: prevents name clipping weirdness */
      flex:1;      /* FIX: give text area room */
    }
    .char .nm{
      font-weight:1000;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis; /* FIX: never â€œÙŠØ£ÙƒÙ„â€ Ø§Ù„Ø§Ø³Ù… */
      max-width:100%;
    }
    .char .mode{font-size:12px;color:var(--muted);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .char .rightBadge{flex:0 0 auto}

    .divider{height:1px;background:rgba(20,40,60,.10);margin:10px 0}
    .footerNote{margin-top:10px;font-size:12px;color:var(--muted);line-height:1.6}

    /* Quiz */
    .quizBox{
      background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
      border-radius: 18px;padding:14px;
    }
    .quizTop{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px;flex-wrap:wrap}
    .qtitle{display:flex;flex-direction:column;gap:2px}
    .qtitle .who{font-weight:1000}
    .qtitle .desc{font-size:12px;color:var(--muted)}
    .progress{font-size:12px;color:var(--muted);white-space:nowrap}
    .q{
      font-size:34px;font-weight:1000;letter-spacing:.5px;margin:10px 0 12px;text-align:center
    }
    .timerWrap{display:flex;align-items:center;gap:10px;margin: 0 0 10px}
    .bar{height:10px;flex:1;border-radius:999px;background: rgba(20,40,60,.10);overflow:hidden}
    .bar > div{
      height:100%;width:100%;
      background: linear-gradient(90deg, var(--good), var(--warn), var(--bad));
      transform-origin: right center;transform: scaleX(1);
      transition: transform .2s linear;
    }
    .sec{min-width:58px;text-align:center;font-weight:1000;color:var(--muted)}

    /* Choices */
    .choices{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 520px){
      .choices{grid-template-columns:1fr}
    }
    .choiceBtn{
      background:#ffffff;
      border:1px solid rgba(20,40,60,.14);
      box-shadow: 0 10px 18px rgba(15,35,55,.06);
      text-align:center;
      padding:14px 12px;
      border-radius:16px;
      font-size:18px;
      font-weight:1000;
    }
    .choiceBtn.correct{
      background:#eafff5;border-color: rgba(26,163,111,.25);
      color:#0d6f4a;
    }
    .choiceBtn.wrong{
      background:#fff0f1;border-color: rgba(255,77,90,.25);
      color:#a61d2a;
    }
    .hint{margin-top:10px;text-align:center;font-size:12px;color:var(--muted);line-height:1.6}
    .toast{
      margin-top:10px;padding:10px 12px;border-radius:14px;font-weight:1000;text-align:center;display:none
    }
    .toast.ok{display:block;background:#eafff5;border:1px solid rgba(26,163,111,.20);color:#0d6f4a}
    .toast.no{display:block;background:#fff0f1;border:1px solid rgba(255,77,90,.20);color:#a61d2a}
    .toast.warn{display:block;background:#fff7e6;border:1px solid rgba(255,176,32,.25);color:#7a4d00}

    /* Right board */
    .scoreboard{display:flex;flex-direction:column;gap:12px}
    .row{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 14px;border-radius: 16px;background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
      flex-wrap:wrap;
    }
    .row .left{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .pts{font-weight:1000;font-size:16px}
    .small{font-size:12px;color:var(--muted);font-weight:1000}
    .rank{display:grid;gap:10px;margin-top:12px}
    .rankItem{
      padding:12px 14px;border-radius:16px;background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
      display:flex;justify-content:space-between;align-items:center;gap:12px;font-weight:1000;
    }
    .rankItem .pos{
      width:32px;height:32px;border-radius:12px;display:grid;place-items:center;
      background:#eef5ff;border:1px solid rgba(43,124,255,.15);color:#1b4aa8;
    }

    .hidden{display:none !important}
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo">+</div>
        <div>
          <h1>ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©</h1>
          <div class="sub">Ù¥ Ø£Ø³Ø¦Ù„Ø© â€” ÙˆÙ‚Øª ØªØ®ØªØ§Ø±Ù‡ â€” Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø¨Ø¯Ù„ ÙƒØªØ§Ø¨Ø© â€” Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ©</div>
        </div>
      </div>

      <div class="pill" id="pillStatus">
        Ø¬Ø§Ù‡Ø²ÙŠÙ†ØŸ Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© ÙˆØ§Ø¨Ø¯Ø£ ğŸ‘‡
        <span class="badge mutebadge" id="pillTime">Ø§Ù„ÙˆÙ‚Øª: Ù¡Ù  Ø«</span>
      </div>
    </div>

    <div class="grid">
      <!-- Left -->
      <div class="card">
        <div class="hd">
          <div>
            <h2 id="mainTitle">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            <p id="mainDesc">Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© Ø«Ù… Ø£Ø¬Ø¨ Ø¨Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯.</p>
          </div>
          <div class="btns">
            <button class="btn-ghost" id="btnHome" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="btn-danger" id="btnReset" title="Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
          </div>
        </div>

        <div class="bd">
          <!-- HOME -->
          <div id="homeView">
            <div class="controls">
              <div class="seg" aria-label="ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„">
                <label>ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                <button class="btn-ghost" data-time="5"  id="t_5">Ù¥ Ø«</button>
                <button class="btn-ghost active" data-time="10" id="t_10">Ù¡Ù  Ø«</button>
                <button class="btn-ghost" data-time="15" id="t_15">Ù¡Ù¥ Ø«</button>
                <button class="btn-ghost" data-time="20" id="t_20">Ù¢Ù  Ø«</button>
              </div>
              <div class="seg">
                <label>Ø§Ù„ØªØ³Ø¬ÙŠÙ„</label>
                <span class="badge">ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© = Ù¢</span>
                <span class="badge mutebadge">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ù¡Ù </span>
              </div>
            </div>

            <div class="chars">
              <div class="char" data-char="mohammed">
                <div class="avatar" aria-hidden="true">
                  <svg width="56" height="56" viewBox="0 0 56 56">
                    <defs>
                      <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0" stop-color="#2b7cff"/>
                        <stop offset="1" stop-color="#6c3bff"/>
                      </linearGradient>
                    </defs>
                    <circle cx="28" cy="30" r="16" fill="#ffd7b3"/>
                    <path d="M13 24c2-10 10-16 15-16 9 0 15 6 15 16-4-4-10-6-15-6s-11 2-15 6z" fill="url(#g1)"/>
                    <circle cx="22" cy="31" r="2" fill="#2b2b2b"/>
                    <circle cx="34" cy="31" r="2" fill="#2b2b2b"/>
                    <path d="M22 38c3 3 9 3 12 0" stroke="#c96b5a" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <path d="M16 49c3-8 21-8 24 0" fill="#eaf0ff"/>
                  </svg>
                </div>
                <div class="meta">
                  <div class="nm">Ù…Ø­Ù…Ø¯</div>
                  <div class="mode">Ø¬Ù…Ø¹ (Ù  Ø¥Ù„Ù‰ Ù¢Ù )</div>
                </div>
                <span class="badge rightBadge" id="badge_mohammed">â€”</span>
              </div>

              <div class="char" data-char="asia">
                <div class="avatar" aria-hidden="true">
                  <svg width="56" height="56" viewBox="0 0 56 56">
                    <defs>
                      <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0" stop-color="#ff4d5a"/>
                        <stop offset="1" stop-color="#ff7a3d"/>
                      </linearGradient>
                    </defs>
                    <circle cx="28" cy="30" r="16" fill="#ffd7b3"/>
                    <path d="M12 24c2-10 9-15 16-15 7 0 14 5 16 15-3-3-9-6-16-6s-13 3-16 6z" fill="url(#g2)"/>
                    <circle cx="22" cy="31" r="2" fill="#2b2b2b"/>
                    <circle cx="34" cy="31" r="2" fill="#2b2b2b"/>
                    <path d="M22 38c3 2 9 2 12 0" stroke="#c96b5a" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <path d="M16 49c3-8 21-8 24 0" fill="#fff0f1"/>
                    <circle cx="15" cy="27" r="4" fill="#ff9bb2" opacity=".9"/>
                    <circle cx="41" cy="27" r="4" fill="#ff9bb2" opacity=".9"/>
                  </svg>
                </div>
                <div class="meta">
                  <div class="nm">Ø¢Ø³ÙŠØ©</div>
                  <div class="mode">Ø¶Ø±Ø¨ (Ù¡ Ø¥Ù„Ù‰ Ù¡Ù )</div>
                </div>
                <span class="badge rightBadge" id="badge_asia">â€”</span>
              </div>

              <div class="char" data-char="salsabil">
                <div class="avatar" aria-hidden="true">
                  <svg width="56" height="56" viewBox="0 0 56 56">
                    <defs>
                      <linearGradient id="g3" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0" stop-color="#1aa36f"/>
                        <stop offset="1" stop-color="#2b7cff"/>
                      </linearGradient>
                    </defs>
                    <circle cx="28" cy="30" r="16" fill="#ffd7b3"/>
                    <path d="M12 24c2-10 10-16 16-16 8 0 14 6 16 16-4-4-10-6-16-6s-12 2-16 6z" fill="url(#g3)"/>
                    <circle cx="22" cy="31" r="2" fill="#2b2b2b"/>
                    <circle cx="34" cy="31" r="2" fill="#2b2b2b"/>
                    <path d="M22 38c3 3 9 3 12 0" stroke="#c96b5a" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <path d="M16 49c3-8 21-8 24 0" fill="#eafff5"/>
                    <path d="M18 20c4 1 7-2 10-2s6 3 10 2" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round" opacity=".9"/>
                  </svg>
                </div>
                <div class="meta">
                  <div class="nm">Ø³Ù„Ø³Ø¨ÙŠÙ„</div>
                  <div class="mode">Ø¶Ø±Ø¨ (Ù¡ Ø¥Ù„Ù‰ Ù¡Ù )</div>
                </div>
                <span class="badge rightBadge" id="badge_salsabil">â€”</span>
              </div>
            </div>

            <div class="divider"></div>
            <div class="footerNote">
              âœ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ ÙˆØªØ¸Ù‡Ø± Ù„ÙˆØ­Ø© ØªØ±ØªÙŠØ¨ Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠÙ„Ø¹Ø¨ÙˆÙ† Ø§Ù„Ø«Ù„Ø§Ø«Ø©.
            </div>
          </div>

          <!-- QUIZ -->
          <div id="quizView" class="hidden">
            <div class="quizBox">
              <div class="quizTop">
                <div class="qtitle">
                  <div class="who" id="whoName">â€”</div>
                  <div class="desc" id="whoDesc">â€”</div>
                </div>
                <div class="progress" id="progressText">â€”</div>
              </div>

              <div class="timerWrap">
                <div class="bar" aria-hidden="true"><div id="barFill"></div></div>
                <div class="sec"><span id="secLeft">Ù¡Ù </span> Ø«</div>
              </div>

              <div class="q" id="questionText">â€”</div>

              <div class="choices" id="choices"></div>

              <div id="toast" class="toast">â€”</div>
              <div class="hint">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø³Ø±Ø¹Ø© âœ¨</div>
            </div>

            <div class="btns" style="margin-top:12px">
              <button class="btn-ghost" id="btnBack">â¬…ï¸ Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            </div>
          </div>

          <!-- RESULT -->
          <div id="resultView" class="hidden">
            <div class="quizBox">
              <div class="q" style="font-size:26px;margin:6px 0 10px" id="resultTitle">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ‰</div>
              <div style="text-align:center;color:var(--muted);font-weight:1000" id="resultSub">â€”</div>

              <div class="divider"></div>

              <div class="btns" style="justify-content:center">
                <button class="btn-primary" id="btnToHome2">Ø§Ø®ØªÙŠØ§Ø± Ø´Ø®ØµÙŠØ© Ø«Ø§Ù†ÙŠØ© ğŸ‘¤</button>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Right -->
      <div class="card">
        <div class="hd">
          <div>
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©</h2>
            <p>Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø© Ù„ÙƒÙ„ Ø·ÙÙ„ (Ù…Ù† Ù¡Ù ) + ØªØ±ØªÙŠØ¨ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©.</p>
          </div>
        </div>

        <div class="bd">
          <div class="scoreboard">
            <div class="row">
              <div class="left"><span class="badge">Ù…Ø­Ù…Ø¯</span><span class="small">Ø¬Ù…Ø¹</span></div>
              <div class="pts" id="score_mohammed">â€”</div>
            </div>
            <div class="row">
              <div class="left"><span class="badge">Ø¢Ø³ÙŠØ©</span><span class="small">Ø¶Ø±Ø¨</span></div>
              <div class="pts" id="score_asia">â€”</div>
            </div>
            <div class="row">
              <div class="left"><span class="badge">Ø³Ù„Ø³Ø¨ÙŠÙ„</span><span class="small">Ø¶Ø±Ø¨</span></div>
              <div class="pts" id="score_salsabil">â€”</div>
            </div>

            <div class="divider"></div>

            <div id="rankBox" class="hidden">
              <div style="font-weight:1000;margin-bottom:8px">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
              <div class="rank" id="rankList"></div>
            </div>

            <div class="footerNote">
              ğŸ§¹ Ù„ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ø¶ØºØ· â€œØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬â€.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // ======= Constants =======
  const Q_COUNT = 5;
  const storageKey = "kids_math_scores_v3";

  const CHAR = {
    mohammed: { name: "Ù…Ø­Ù…Ø¯", desc: "Ø¬Ù…Ø¹ Ù„Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ù…Ù† Ù  Ø¥Ù„Ù‰ Ù¢Ù ", mode: "add" },
    asia:     { name: "Ø¢Ø³ÙŠØ©", desc: "Ø¶Ø±Ø¨ Ù„Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ù…Ù† Ù¡ Ø¥Ù„Ù‰ Ù¡Ù ", mode: "mul" },
    salsabil: { name: "Ø³Ù„Ø³Ø¨ÙŠÙ„", desc: "Ø¶Ø±Ø¨ Ù„Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ù…Ù† Ù¡ Ø¥Ù„Ù‰ Ù¡Ù ", mode: "mul" },
  };

  // ======= Arabic-Indic digits =======
  const arabicDigits = ["Ù ","Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©"];
  function toArabicIndic(str){
    return String(str).replace(/\d/g, d => arabicDigits[Number(d)]);
  }

  // ======= State =======
  let currentChar = null;
  let questions = []; // {text, answer, key, choices[]}
  let idx = 0;
  let points = 0; // out of 10 (each correct = 2)
  let timer = null;
  let secLeft = 10;
  let secPerQ = 10;

  // ======= DOM =======
  const pillStatus = document.getElementById("pillStatus");
  const pillTime = document.getElementById("pillTime");

  const homeView = document.getElementById("homeView");
  const quizView = document.getElementById("quizView");
  const resultView = document.getElementById("resultView");

  const whoName = document.getElementById("whoName");
  const whoDesc = document.getElementById("whoDesc");
  const progressText = document.getElementById("progressText");
  const questionText = document.getElementById("questionText");
  const choicesEl = document.getElementById("choices");

  const secLeftEl = document.getElementById("secLeft");
  const barFill = document.getElementById("barFill");
  const toast = document.getElementById("toast");

  const resultTitle = document.getElementById("resultTitle");
  const resultSub = document.getElementById("resultSub");

  const btnBack = document.getElementById("btnBack");
  const btnHome = document.getElementById("btnHome");
  const btnReset = document.getElementById("btnReset");
  const btnToHome2 = document.getElementById("btnToHome2");

  const scoreMoh = document.getElementById("score_mohammed");
  const scoreAsia = document.getElementById("score_asia");
  const scoreSal = document.getElementById("score_salsabil");

  const badgeMoh = document.getElementById("badge_mohammed");
  const badgeAsia = document.getElementById("badge_asia");
  const badgeSal = document.getElementById("badge_salsabil");

  const rankBox = document.getElementById("rankBox");
  const rankList = document.getElementById("rankList");

  // Time buttons
  const timeBtns = {
    5:  document.getElementById("t_5"),
    10: document.getElementById("t_10"),
    15: document.getElementById("t_15"),
    20: document.getElementById("t_20"),
  };

  // ======= Helpers =======
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const randint = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;

  function loadScores(){
    try{ return JSON.parse(localStorage.getItem(storageKey) || "{}"); }
    catch{ return {}; }
  }
  function saveScores(s){ localStorage.setItem(storageKey, JSON.stringify(s)); }

  function setView(which){
    homeView.classList.add("hidden");
    quizView.classList.add("hidden");
    resultView.classList.add("hidden");
    which.classList.remove("hidden");
  }

  function showToast(kind, msg){
    toast.className = "toast " + kind; // ok/no/warn
    toast.textContent = msg;
    setTimeout(() => { toast.className = "toast"; toast.textContent = "â€”"; }, 900);
  }

  function setTimePerQuestion(sec){
    secPerQ = sec;
    Object.keys(timeBtns).forEach(k => timeBtns[k].classList.toggle("active", Number(k) === sec));
    pillTime.textContent = `Ø§Ù„ÙˆÙ‚Øª: ${toArabicIndic(sec)} Ø«`;
  }

  // Unique operation keys per round
  function makeKeyAdd(a,b){
    const x = Math.min(a,b), y = Math.max(a,b);
    return `add:${x}+${y}`;
  }
  function makeKeyMul(a,b){
    const x = Math.min(a,b), y = Math.max(a,b);
    return `mul:${x}x${y}`;
  }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function makeChoices(correct, mode){
    // 4 choices total
    const s = new Set([correct]);

    while(s.size < 4){
      let cand;
      if(mode === "add"){
        // close-ish values
        const delta = randint(-6, 6);
        cand = correct + delta;
        if(cand < 0) cand = Math.abs(cand);
      } else {
        // multiplication: small variations
        const delta = randint(-10, 10);
        cand = correct + delta;
        if(cand < 0) cand = Math.abs(cand);
      }
      s.add(cand);
    }
    return shuffle([...s]);
  }

  function generateQuestions(charKey){
    const mode = CHAR[charKey].mode;
    const used = new Set();
    const qs = [];

    while(qs.length < Q_COUNT){
      let a,b,ans,text,key;

      if(mode === "add"){
        a = randint(0,20);
        b = randint(0,20);
        ans = a + b;
        key = makeKeyAdd(a,b);
        text = `${toArabicIndic(a)} + ${toArabicIndic(b)} = ØŸ`;
      } else {
        a = randint(1,10);
        b = randint(1,10);
        ans = a * b;
        key = makeKeyMul(a,b);
        text = `${toArabicIndic(a)} Ã— ${toArabicIndic(b)} = ØŸ`;
      }

      if(used.has(key)) continue;
      used.add(key);

      const choices = makeChoices(ans, mode).map(n => toArabicIndic(n));
      qs.push({ text, answer: ans, key, choices });
    }
    return qs;
  }

  function startRound(charKey){
    currentChar = charKey;
    questions = generateQuestions(charKey);
    idx = 0;
    points = 0;

    whoName.textContent = `ğŸ‘¤ ${CHAR[charKey].name}`;
    whoDesc.textContent = `${CHAR[charKey].desc} â€” ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„: ${toArabicIndic(secPerQ)} Ø«`;

    pillStatus.firstChild.textContent = `Ø¨Ø¯Ø£Ù†Ø§! Ø¯ÙˆØ± ${CHAR[charKey].name} ğŸš€ `;
    setView(quizView);
    renderQuestion();
  }

  function stopTimer(){
    if(timer){ clearInterval(timer); timer = null; }
  }

  function updateTimerUI(){
    secLeftEl.textContent = toArabicIndic(clamp(secLeft,0,secPerQ));
    const ratio = clamp(secLeft / secPerQ, 0, 1);
    barFill.style.transform = `scaleX(${ratio})`;
  }

  function startTimer(){
    stopTimer();
    secLeft = secPerQ;
    updateTimerUI();
    timer = setInterval(() => {
      secLeft -= 1;
      updateTimerUI();
      if(secLeft <= 0){
        stopTimer();
        disableChoices();
        showToast("warn", "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª â±ï¸");
        setTimeout(() => nextQuestion(false, true), 350);
      }
    }, 1000);
  }

  function disableChoices(){
    [...choicesEl.querySelectorAll("button")].forEach(b => b.disabled = true);
  }

  function renderQuestion(){
    const q = questions[idx];
    progressText.textContent = `Ø³Ø¤Ø§Ù„ ${toArabicIndic(idx+1)} Ù…Ù† ${toArabicIndic(Q_COUNT)}`;
    questionText.textContent = q.text;

    choicesEl.innerHTML = "";
    q.choices.forEach((label) => {
      const btn = document.createElement("button");
      btn.className = "choiceBtn";
      btn.textContent = label;
      btn.addEventListener("click", () => chooseAnswer(label, q));
      choicesEl.appendChild(btn);
    });

    startTimer();
  }

  function chooseAnswer(label, q){
    stopTimer();
    disableChoices();

    const chosen = Number(label.replace(/[Ù -Ù©]/g, d => arabicDigits.indexOf(d)));
    const isCorrect = chosen === q.answer;

    // mark buttons
    [...choicesEl.querySelectorAll("button")].forEach(b => {
      const val = Number(b.textContent.replace(/[Ù -Ù©]/g, d => arabicDigits.indexOf(d)));
      if(val === q.answer) b.classList.add("correct");
      if(b.textContent === label && !isCorrect) b.classList.add("wrong");
    });

    if(isCorrect){
      points += 2;
      showToast("ok", "ØµØ­ âœ…");
    } else {
      showToast("no", "Ø®Ø·Ø£ âŒ");
    }

    setTimeout(() => nextQuestion(isCorrect, false), 550);
  }

  function nextQuestion(wasCorrect, wasTimeout){
    idx += 1;
    if(idx >= Q_COUNT){
      finishRound();
    } else {
      renderQuestion();
    }
  }

  function finishRound(){
    stopTimer();
    const name = CHAR[currentChar].name;
    resultTitle.textContent = `Ø§Ù†ØªÙ‡Øª Ø¬ÙˆÙ„Ø© ${name} ğŸ‰`;
    resultSub.textContent = `Ø¯Ø±Ø¬ØªÙƒ: ${toArabicIndic(points)} Ù…Ù† ${toArabicIndic(10)} (ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„: ${toArabicIndic(secPerQ)} Ø«)`;

    // Save
    const scores = loadScores();
    scores[currentChar] = { last: points, time: secPerQ, updatedAt: Date.now() };
    scores.updatedAt = Date.now();
    saveScores(scores);

    refreshBoard();
    pillStatus.firstChild.textContent = `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© ${name}: ${toArabicIndic(points)}/${toArabicIndic(10)} âœ… `;
    setView(resultView);
  }

  function refreshBoard(){
    const scores = loadScores();
    const vMoh  = scores.mohammed?.last ?? null;
    const vAsia = scores.asia?.last ?? null;
    const vSal  = scores.salsabil?.last ?? null;

    function fmt(v){ return v === null ? "â€”" : `${toArabicIndic(v)}/${toArabicIndic(10)}`; }

    scoreMoh.textContent  = fmt(vMoh);
    scoreAsia.textContent = fmt(vAsia);
    scoreSal.textContent  = fmt(vSal);

    badgeMoh.textContent  = vMoh  === null ? "Ù„Ù… ÙŠÙ„Ø¹Ø¨" : fmt(vMoh);
    badgeAsia.textContent = vAsia === null ? "Ù„Ù… ØªÙ„Ø¹Ø¨" : fmt(vAsia);
    badgeSal.textContent  = vSal  === null ? "Ù„Ù… ØªÙ„Ø¹Ø¨" : fmt(vSal);

    const allDone = [vMoh, vAsia, vSal].every(v => typeof v === "number");
    if(allDone){
      const arr = [
        { key:"mohammed", name:"Ù…Ø­Ù…Ø¯", score:vMoh },
        { key:"asia", name:"Ø¢Ø³ÙŠØ©", score:vAsia },
        { key:"salsabil", name:"Ø³Ù„Ø³Ø¨ÙŠÙ„", score:vSal },
      ].sort((a,b) => b.score - a.score);

      rankList.innerHTML = "";
      arr.forEach((it, i) => {
        const div = document.createElement("div");
        div.className = "rankItem";
        div.innerHTML = `
          <div style="display:flex;align-items:center;gap:10px">
            <div class="pos">${toArabicIndic(i+1)}</div>
            <div>${it.name}</div>
          </div>
          <div>${toArabicIndic(it.score)}/${toArabicIndic(10)}</div>
        `;
        rankList.appendChild(div);
      });

      rankBox.classList.remove("hidden");
    } else {
      rankBox.classList.add("hidden");
      rankList.innerHTML = "";
    }
  }

  function goHome(){
    stopTimer();
    currentChar = null;
    questions = [];
    idx = 0;
    points = 0;
    pillStatus.firstChild.textContent = "Ø¬Ø§Ù‡Ø²ÙŠÙ†ØŸ Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© ÙˆØ§Ø¨Ø¯Ø£ ğŸ‘‡ ";
    setView(homeView);
  }

  function resetAll(){
    stopTimer();
    localStorage.removeItem(storageKey);
    refreshBoard();
    goHome();
    pillStatus.firstChild.textContent = "ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ âœ… ";
  }

  // ======= Events =======
  document.querySelectorAll(".char").forEach(el => {
    el.addEventListener("click", () => {
      const key = el.getAttribute("data-char");
      startRound(key);
    });
  });

  Object.values(timeBtns).forEach(btn => {
    btn.addEventListener("click", () => setTimePerQuestion(Number(btn.dataset.time)));
  });

  btnBack.addEventListener("click", goHome);
  btnHome.addEventListener("click", goHome);
  btnToHome2.addEventListener("click", goHome);
  btnReset.addEventListener("click", resetAll);

  // ======= Init =======
  setTimePerQuestion(10);
  refreshBoard();
})();
</script>
</body>
</html>
