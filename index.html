<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ | Ù…Ø­Ù…Ø¯ - Ø¢Ø³ÙŠØ© - Ø³Ù„Ø³Ø¨ÙŠÙ„</title>
  <style>
    :root{
      --bg1:#f7fbff;
      --bg2:#fff7fb;
      --card:#ffffffcc;
      --ink:#0b1b2b;
      --muted:#5b6b7a;
      --primary:#2b7cff;
      --primary2:#6c3bff;
      --good:#1aa36f;
      --bad:#ff4d5a;
      --warn:#ffb020;
      --shadow: 0 18px 40px rgba(15,35,55,.12);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 20% 10%, #dff1ff 0%, transparent 60%),
        radial-gradient(900px 650px at 80% 20%, #f4ddff 0%, transparent 60%),
        radial-gradient(900px 650px at 40% 90%, #ffe6ef 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .app{width:min(1040px, 100%)}
    .topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      box-shadow: var(--shadow);
      display:grid;place-items:center;color:white;font-weight:900;
    }
    .brand h1{margin:0;font-size:18px;line-height:1.2}
    .brand .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .pill{
      background: #ffffffb0;
      border:1px solid rgba(20,40,60,.08);
      padding:10px 12px;
      border-radius:999px;
      box-shadow: 0 10px 24px rgba(15,35,55,.08);
      display:flex;gap:10px;align-items:center;color:var(--muted);
      font-size:13px;flex-wrap:wrap
    }
    .grid{display:grid;grid-template-columns: 1.15fr .85fr;gap:16px}
    @media (max-width: 900px){.grid{grid-template-columns:1fr}}
    .card{
      background: var(--card);
      border: 1px solid rgba(20,40,60,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card .hd{padding:18px 18px 10px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .card .hd h2{margin:0;font-size:18px}
    .card .hd p{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.6}
    .card .bd{padding:14px 18px 18px}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:0;border-radius: 14px;padding:12px 14px;
      font-weight:800;cursor:pointer;transition: transform .08s ease, filter .2s ease;
      font-size:14px;
    }
    button:active{transform: translateY(1px) scale(.99)}
    .btn-primary{
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:white;
      box-shadow: 0 14px 26px rgba(43,124,255,.25);
    }
    .btn-ghost{
      background:#ffffffc8;
      border:1px solid rgba(20,40,60,.12);
      color:var(--ink);
    }
    .btn-danger{
      background: linear-gradient(135deg, #ff4d5a, #ff7a3d);
      color:white;
      box-shadow: 0 14px 26px rgba(255,77,90,.22);
    }
    .btn-good{
      background: linear-gradient(135deg, #1aa36f, #2b7cff);
      color:white;
      box-shadow: 0 14px 26px rgba(26,163,111,.20);
    }

    .chars{display:grid;grid-template-columns: repeat(3, 1fr);gap:12px;margin-top:10px}
    @media (max-width: 560px){.chars{grid-template-columns:1fr}}
    .char{
      border-radius: 18px;border:1px solid rgba(20,40,60,.10);
      background:#ffffffb8;padding:12px;display:flex;gap:10px;align-items:center;
      cursor:pointer;user-select:none;transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
    }
    .char:hover{transform: translateY(-2px);box-shadow: 0 16px 34px rgba(15,35,55,.12);filter:saturate(1.05)}
    .char .nm{font-weight:1000}
    .char .mode{font-size:12px;color:var(--muted);margin-top:2px}
    .char .meta{display:flex;flex-direction:column}
    .avatar{
      width:56px;height:56px;border-radius:18px;display:grid;place-items:center;
      background: radial-gradient(circle at 30% 20%, #fff 0%, #f2f7ff 55%, #eaf0ff 100%);
      border:1px solid rgba(20,40,60,.10);overflow:hidden;
    }
    .badge{
      font-size:12px;padding:6px 10px;border-radius:999px;
      background: #eef5ff;border:1px solid rgba(43,124,255,.15);
      color:#1b4aa8;font-weight:900;white-space:nowrap;
    }
    .mutebadge{
      background:#f7f7f9;border:1px solid rgba(20,40,60,.10);color:var(--muted);
    }
    .divider{height:1px;background:rgba(20,40,60,.10);margin:10px 0}
    .footerNote{margin-top:10px;font-size:12px;color:var(--muted);line-height:1.6}

    /* Difficulty + toggles */
    .controls{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px
    }
    .seg{
      display:flex;gap:6px;align-items:center;
      padding:8px;border-radius:16px;
      background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
    }
    .seg label{font-size:12px;color:var(--muted);font-weight:900;margin-inline:6px}
    .seg button{padding:10px 12px;border-radius:12px;font-size:13px}
    .seg .active{
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:#fff;
    }

    /* Quiz */
    .quizBox{
      background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
      border-radius: 18px;padding:14px;
    }
    .quizTop{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px;flex-wrap:wrap}
    .qtitle{display:flex;flex-direction:column;gap:2px}
    .qtitle .who{font-weight:1000}
    .qtitle .desc{font-size:12px;color:var(--muted)}
    .progress{font-size:12px;color:var(--muted);white-space:nowrap}
    .q{
      font-size:34px;font-weight:1000;letter-spacing:.5px;margin:10px 0 12px;text-align:center
    }
    .timerWrap{display:flex;align-items:center;gap:10px;margin: 0 0 10px}
    .bar{height:10px;flex:1;border-radius:999px;background: rgba(20,40,60,.10);overflow:hidden}
    .bar > div{
      height:100%;width:100%;
      background: linear-gradient(90deg, var(--good), var(--warn), var(--bad));
      transform-origin: right center;transform: scaleX(1);
      transition: transform .2s linear;
    }
    .sec{min-width:44px;text-align:center;font-weight:1000;color:var(--muted)}
    .answer{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;margin-top:10px}
    input[type="number"]{
      width:min(260px, 100%);
      padding:12px 14px;border-radius:14px;border:1px solid rgba(20,40,60,.14);
      background:#ffffff;font-size:18px;font-weight:1000;text-align:center;outline:none;
      box-shadow: 0 10px 18px rgba(15,35,55,.06);
    }
    .hint{margin-top:10px;text-align:center;font-size:12px;color:var(--muted);line-height:1.6}
    .toast{
      margin-top:10px;padding:10px 12px;border-radius:14px;font-weight:1000;text-align:center;display:none
    }
    .toast.ok{display:block;background:#eafff5;border:1px solid rgba(26,163,111,.20);color:#0d6f4a}
    .toast.no{display:block;background:#fff0f1;border:1px solid rgba(255,77,90,.20);color:#a61d2a}
    .toast.warn{display:block;background:#fff7e6;border:1px solid rgba(255,176,32,.25);color:#7a4d00}

    /* Right board */
    .scoreboard{display:flex;flex-direction:column;gap:12px}
    .row{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 14px;border-radius: 16px;background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
      flex-wrap:wrap;
    }
    .row .left{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .pts{font-weight:1000;font-size:16px}
    .small{font-size:12px;color:var(--muted);font-weight:900}
    .rank{display:grid;gap:10px;margin-top:12px}
    .rankItem{
      padding:12px 14px;border-radius:16px;background:#ffffffb8;border:1px solid rgba(20,40,60,.10);
      display:flex;justify-content:space-between;align-items:center;gap:12px;font-weight:1000;
    }
    .rankItem .pos{
      width:32px;height:32px;border-radius:12px;display:grid;place-items:center;
      background:#eef5ff;border:1px solid rgba(43,124,255,.15);color:#1b4aa8;
    }
    .hidden{display:none !important}

    /* Celebration */
    .spark{
      position:fixed;inset:auto auto 20px 20px;
      padding:10px 12px;border-radius:14px;
      background: #ffffffd6;border:1px solid rgba(20,40,60,.10);
      box-shadow: 0 16px 34px rgba(15,35,55,.12);
      font-weight:1000;color:var(--ink);
      transform: translateY(20px);
      opacity:0;pointer-events:none;
      transition: .25s ease;
    }
    .spark.show{
      transform: translateY(0);
      opacity:1;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo">+</div>
        <div>
          <h1>ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©</h1>
          <div class="sub">5 Ø£Ø³Ø¦Ù„Ø© â€” 10 Ø«ÙˆØ§Ù†ÙŠ Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ â€” Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† 10</div>
        </div>
      </div>

      <div class="pill" id="pillStatus">
        Ø¬Ø§Ù‡Ø²ÙŠÙ†ØŸ Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© ÙˆØ§Ø¨Ø¯Ø£ ğŸ‘‡
        <span class="badge mutebadge" id="pillDiff">Ø§Ù„ØµØ¹ÙˆØ¨Ø©: Ø³Ù‡Ù„</span>
        <span class="badge mutebadge" id="pillSound">Ø§Ù„ØµÙˆØª: ØªØ´ØºÙŠÙ„</span>
      </div>
    </div>

    <div class="grid">
      <!-- Left -->
      <div class="card">
        <div class="hd">
          <div>
            <h2 id="mainTitle">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            <p id="mainDesc">Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ. ØªÙ‚Ø¯Ø± ØªØºÙŠÙ‘Ø± Ø§Ù„ØµØ¹ÙˆØ¨Ø© ÙˆØªØ´ØºÙ‘Ù„/ØªØ·ÙÙŠ Ø§Ù„ØµÙˆØª.</p>
          </div>
          <div class="btns">
            <button class="btn-ghost" id="btnHome" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="btn-ghost" id="btnToggleSound" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª">ğŸ”Š Ø§Ù„ØµÙˆØª</button>
            <button class="btn-danger" id="btnReset" title="Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
          </div>
        </div>

        <div class="bd">
          <!-- HOME -->
          <div id="homeView">
            <div class="controls">
              <div class="seg" aria-label="Ø§Ù„ØµØ¹ÙˆØ¨Ø©">
                <label>Ø§Ù„ØµØ¹ÙˆØ¨Ø©</label>
                <button class="btn-ghost" data-diff="easy" id="diff_easy">Ø³Ù‡Ù„</button>
                <button class="btn-ghost" data-diff="med"  id="diff_med">Ù…ØªÙˆØ³Ø·</button>
                <button class="btn-ghost" data-diff="hard" id="diff_hard">ØµØ¹Ø¨</button>
              </div>

              <div class="seg" aria-label="Ù…Ø¹Ù„ÙˆÙ…Ø©">
                <label>Ø§Ù„Ù‡Ø¯Ù</label>
                <span class="badge">ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© = 2</span>
                <span class="badge mutebadge">Ù…Ø­Ø§ÙˆÙ„Ø© Ø«Ø§Ù†ÙŠØ© Ù…Ø³Ù…ÙˆØ­Ø© Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª</span>
              </div>
            </div>

            <div class="chars">
              <div class="char" data-char="mohammed">
                <div class="avatar" aria-hidden="true">
                  <!-- Boy SVG -->
                  <svg width="56" height="56" viewBox="0 0 56 56">
                    <defs>
                      <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0" stop-color="#2b7cff"/>
                        <stop offset="1" stop-color="#6c3bff"/>
                      </linearGradient>
                    </defs>
                    <circle cx="28" cy="30" r="16" fill="#ffd7b3"/>
                    <path d="M13 24c2-10 10-16 15-16 9 0 15 6 15 16-4-4-10-6-15-6s-11 2-15 6z" fill="url(#g1)"/>
                    <circle cx="22" cy="31" r="2" fill="#2b2b2b"/>
                    <circle cx="34" cy="31" r="2" fill="#2b2b2b"/>
                    <path d="M22 38c3 3 9 3 12 0" stroke="#c96b5a" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <path d="M16 49c3-8 21-8 24 0" fill="#eaf0ff"/>
                  </svg>
                </div>
                <div class="meta">
                  <div class="nm">Ù…Ø­Ù…Ø¯</div>
                  <div class="mode">Ø¬Ù…Ø¹ (Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø©)</div>
                </div>
                <span class="badge" id="badge_mohammed">â€”</span>
              </div>

              <div class="char" data-char="asia">
                <div class="avatar" aria-hidden="true">
                  <!-- Girl SVG -->
                  <svg width="56" height="56" viewBox="0 0 56 56">
                    <defs>
                      <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0" stop-color="#ff4d5a"/>
                        <stop offset="1" stop-color="#ff7a3d"/>
                      </linearGradient>
                    </defs>
                    <circle cx="28" cy="30" r="16" fill="#ffd7b3"/>
                    <path d="M12 24c2-10 9-15 16-15 7 0 14 5 16 15-3-3-9-6-16-6s-13 3-16 6z" fill="url(#g2)"/>
                    <circle cx="22" cy="31" r="2" fill="#2b2b2b"/>
                    <circle cx="34" cy="31" r="2" fill="#2b2b2b"/>
                    <path d="M22 38c3 2 9 2 12 0" stroke="#c96b5a" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <path d="M16 49c3-8 21-8 24 0" fill="#fff0f1"/>
                    <circle cx="15" cy="27" r="4" fill="#ff9bb2" opacity=".9"/>
                    <circle cx="41" cy="27" r="4" fill="#ff9bb2" opacity=".9"/>
                  </svg>
                </div>
                <div class="meta">
                  <div class="nm">Ø¢Ø³ÙŠØ©</div>
                  <div class="mode">Ø¶Ø±Ø¨ (Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø©)</div>
                </div>
                <span class="badge" id="badge_asia">â€”</span>
              </div>

              <div class="char" data-char="salsabil">
                <div class="avatar" aria-hidden="true">
                  <!-- Girl SVG 2 -->
                  <svg width="56" height="56" viewBox="0 0 56 56">
                    <defs>
                      <linearGradient id="g3" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0" stop-color="#1aa36f"/>
                        <stop offset="1" stop-color="#2b7cff"/>
                      </linearGradient>
                    </defs>
                    <circle cx="28" cy="30" r="16" fill="#ffd7b3"/>
                    <path d="M12 24c2-10 10-16 16-16 8 0 14 6 16 16-4-4-10-6-16-6s-12 2-16 6z" fill="url(#g3)"/>
                    <circle cx="22" cy="31" r="2" fill="#2b2b2b"/>
                    <circle cx="34" cy="31" r="2" fill="#2b2b2b"/>
                    <path d="M22 38c3 3 9 3 12 0" stroke="#c96b5a" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <path d="M16 49c3-8 21-8 24 0" fill="#eafff5"/>
                    <path d="M18 20c4 1 7-2 10-2s6 3 10 2" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round" opacity=".9"/>
                  </svg>
                </div>
                <div class="meta">
                  <div class="nm">Ø³Ù„Ø³Ø¨ÙŠÙ„</div>
                  <div class="mode">Ø¶Ø±Ø¨ (Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø©)</div>
                </div>
                <span class="badge" id="badge_salsabil">â€”</span>
              </div>
            </div>

            <div class="divider"></div>
            <div class="footerNote">
              ğŸ’¡ Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠÙ„Ø¹Ø¨ÙˆÙ† Ø§Ù„Ø«Ù„Ø§Ø«Ø©ØŒ ÙŠØ¸Ù‡Ø± ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†Ø§ÙØ³Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ (Ø­Ø³Ø¨ <b>Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø©</b>). <br/>
              âœ… Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².
            </div>
          </div>

          <!-- QUIZ -->
          <div id="quizView" class="hidden">
            <div class="quizBox">
              <div class="quizTop">
                <div class="qtitle">
                  <div class="who" id="whoName">â€”</div>
                  <div class="desc" id="whoDesc">â€”</div>
                </div>
                <div class="progress" id="progressText">Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 5</div>
              </div>

              <div class="timerWrap">
                <div class="bar" aria-hidden="true"><div id="barFill"></div></div>
                <div class="sec"><span id="secLeft">10</span>Ø«</div>
              </div>

              <div class="q" id="questionText">â€”</div>

              <div class="answer">
                <input id="answerInput" type="number" inputmode="numeric" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©" />
                <button class="btn-primary" id="btnSubmit">Ø¥Ø±Ø³Ø§Ù„ âœ…</button>
                <button class="btn-ghost" id="btnSkip">ØªØ®Ø·ÙŠ â­ï¸</button>
              </div>

              <div id="toast" class="toast">â€”</div>
              <div class="hint">Ø§Ø¶ØºØ· Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø³Ø±Ø¹Ø© âœ¨</div>
            </div>

            <div class="btns" style="margin-top:12px">
              <button class="btn-ghost" id="btnBack">â¬…ï¸ Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            </div>
          </div>

          <!-- RESULT -->
          <div id="resultView" class="hidden">
            <div class="quizBox">
              <div class="q" style="font-size:26px;margin:6px 0 10px" id="resultTitle">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ‰</div>
              <div style="text-align:center;color:var(--muted);font-weight:1000" id="resultSub">â€”</div>

              <div class="divider"></div>

              <div style="font-weight:1000;margin-bottom:8px">ğŸ“‹ Ù…Ù„Ø®Ù‘Øµ Ø§Ù„Ø¬ÙˆÙ„Ø©</div>
              <div id="reviewBox" style="display:grid;gap:8px"></div>

              <div class="divider"></div>

              <div class="btns" style="justify-content:center">
                <button class="btn-good" id="btnPlayAgain">Ø¥Ø¹Ø§Ø¯Ø© Ù†ÙØ³ Ø§Ù„Ø´Ø®ØµÙŠØ© ğŸ”</button>
                <button class="btn-ghost" id="btnToHome2">Ø§Ø®ØªÙŠØ§Ø± Ø´Ø®ØµÙŠØ© Ø«Ø§Ù†ÙŠØ© ğŸ‘¤</button>
              </div>

              <div class="footerNote" style="text-align:center">
                ğŸŒŸ Ù†ØµÙŠØ­Ø©: Ù„Ùˆ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø¶Ø¹ÙŠÙØ©ØŒ Ø¬Ø±Ù‘Ø¨ â€œØ³Ù‡Ù„â€ Ø£ÙˆÙ„ØŒ Ø«Ù… Ø§Ø±ÙØ¹ Ø§Ù„ØµØ¹ÙˆØ¨Ø©.
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Right -->
      <div class="card">
        <div class="hd">
          <div>
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©</h2>
            <p>ØªØ¸Ù‡Ø± (Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø© + Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©) Ù„ÙƒÙ„ Ø·ÙÙ„ØŒ ÙˆØ§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©.</p>
          </div>
        </div>

        <div class="bd">
          <div class="scoreboard" id="scoreboard">
            <div class="row">
              <div class="left">
                <span class="badge">Ù…Ø­Ù…Ø¯</span>
                <span class="small" id="mode_m">â€”</span>
              </div>
              <div class="pts" id="score_mohammed">â€”</div>
            </div>

            <div class="row">
              <div class="left">
                <span class="badge">Ø¢Ø³ÙŠØ©</span>
                <span class="small" id="mode_a">â€”</span>
              </div>
              <div class="pts" id="score_asia">â€”</div>
            </div>

            <div class="row">
              <div class="left">
                <span class="badge">Ø³Ù„Ø³Ø¨ÙŠÙ„</span>
                <span class="small" id="mode_s">â€”</span>
              </div>
              <div class="pts" id="score_salsabil">â€”</div>
            </div>

            <div class="divider"></div>

            <div id="rankBox" class="hidden">
              <div style="font-weight:1000;margin-bottom:8px">ğŸ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø©)</div>
              <div class="rank" id="rankList"></div>
            </div>

            <div class="footerNote">
              âœ… â€œØ£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©â€ ØªÙØ­ÙÙ‘Ø²Ù‡Ù… ÙŠØ­Ø³Ù‘Ù†ÙˆÙ† Ù…Ø³ØªÙˆØ§Ù‡Ù…. <br/>
              ğŸ§¹ ØªÙ‚Ø¯Ø± ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰.
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="spark" id="spark">ğŸŒŸ Ù…Ù…ØªØ§Ø²!</div>

<script>
(() => {
  // ========== Config ==========
  const Q_COUNT = 5;
  const SEC_PER_Q = 10;

  const CHAR = {
    mohammed: { name: "Ù…Ø­Ù…Ø¯", baseDesc: "Ø¬Ù…Ø¹", mode: "add" },
    asia:     { name: "Ø¢Ø³ÙŠØ©", baseDesc: "Ø¶Ø±Ø¨", mode: "mul" },
    salsabil: { name: "Ø³Ù„Ø³Ø¨ÙŠÙ„", baseDesc: "Ø¶Ø±Ø¨", mode: "mul" },
  };

  // Difficulty affects ranges (kept kid-friendly)
  const DIFF = {
    easy: { label:"Ø³Ù‡Ù„", addMax:10, mulMax:5 },
    med:  { label:"Ù…ØªÙˆØ³Ø·", addMax:20, mulMax:10 },
    hard: { label:"ØµØ¹Ø¨", addMax:50, mulMax:12 },
  };

  const storageKey = "kids_math_scores_v2";

  // ========== State ==========
  let currentChar = null;
  let currentDiff = "easy";
  let soundOn = true;

  let questions = []; // {text, answer, key, userAns, correct, timeout}
  let idx = 0;
  let points = 0;     // out of 10 (each correct=2)
  let timer = null;
  let secLeft = SEC_PER_Q;
  let wrongAttemptsThisQ = 0; // allow retry within time
  let audioCtx = null;

  // ========== DOM ==========
  const pillStatus = document.getElementById("pillStatus");
  const pillDiff = document.getElementById("pillDiff");
  const pillSound = document.getElementById("pillSound");

  const homeView = document.getElementById("homeView");
  const quizView = document.getElementById("quizView");
  const resultView = document.getElementById("resultView");

  const mainTitle = document.getElementById("mainTitle");
  const mainDesc  = document.getElementById("mainDesc");

  const whoName = document.getElementById("whoName");
  const whoDesc = document.getElementById("whoDesc");
  const progressText = document.getElementById("progressText");
  const questionText = document.getElementById("questionText");
  const answerInput = document.getElementById("answerInput");
  const btnSubmit = document.getElementById("btnSubmit");
  const btnSkip = document.getElementById("btnSkip");
  const btnBack = document.getElementById("btnBack");
  const btnHome = document.getElementById("btnHome");
  const btnReset = document.getElementById("btnReset");
  const btnToggleSound = document.getElementById("btnToggleSound");

  const secLeftEl = document.getElementById("secLeft");
  const barFill = document.getElementById("barFill");
  const toast = document.getElementById("toast");

  const resultTitle = document.getElementById("resultTitle");
  const resultSub = document.getElementById("resultSub");
  const btnPlayAgain = document.getElementById("btnPlayAgain");
  const btnToHome2 = document.getElementById("btnToHome2");
  const reviewBox = document.getElementById("reviewBox");

  const scoreMoh = document.getElementById("score_mohammed");
  const scoreAsia = document.getElementById("score_asia");
  const scoreSal = document.getElementById("score_salsabil");
  const badgeMoh = document.getElementById("badge_mohammed");
  const badgeAsia = document.getElementById("badge_asia");
  const badgeSal = document.getElementById("badge_salsabil");

  const modeM = document.getElementById("mode_m");
  const modeA = document.getElementById("mode_a");
  const modeS = document.getElementById("mode_s");

  const rankBox = document.getElementById("rankBox");
  const rankList = document.getElementById("rankList");

  const spark = document.getElementById("spark");

  const diffBtns = {
    easy: document.getElementById("diff_easy"),
    med:  document.getElementById("diff_med"),
    hard: document.getElementById("diff_hard"),
  };

  // ========== Helpers ==========
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const randint = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;

  function showSpark(msg){
    spark.textContent = msg;
    spark.classList.add("show");
    setTimeout(() => spark.classList.remove("show"), 900);
  }

  function ensureAudio(){
    if(!audioCtx){
      const AC = window.AudioContext || window.webkitAudioContext;
      if(AC) audioCtx = new AC();
    }
  }

  function beep(freq=440, ms=90, type="sine", gain=0.04){
    if(!soundOn) return;
    ensureAudio();
    if(!audioCtx) return;
    const t0 = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g);
    g.connect(audioCtx.destination);
    o.start(t0);
    o.stop(t0 + ms/1000);
  }

  function soundOk(){ beep(660, 90, "triangle", 0.05); setTimeout(()=>beep(880, 90, "triangle", 0.05), 90); }
  function soundNo(){ beep(220, 120, "sawtooth", 0.035); }
  function soundTick(){ beep(520, 40, "sine", 0.02); }
  function soundWin(){ beep(523,120,"triangle",0.05); setTimeout(()=>beep(659,120,"triangle",0.05),130); setTimeout(()=>beep(784,140,"triangle",0.05),270); }

  function loadState(){
    try{
      const raw = localStorage.getItem(storageKey);
      return raw ? JSON.parse(raw) : {};
    }catch{ return {}; }
  }
  function saveState(s){ localStorage.setItem(storageKey, JSON.stringify(s)); }

  function setView(which){
    homeView.classList.add("hidden");
    quizView.classList.add("hidden");
    resultView.classList.add("hidden");
    which.classList.remove("hidden");
  }

  function showToast(kind, msg){
    toast.className = "toast " + kind; // ok/no/warn
    toast.textContent = msg;
    setTimeout(() => { toast.className = "toast"; toast.textContent = "â€”"; }, 980);
  }

  function setDifficulty(diff){
    currentDiff = diff;
    Object.keys(diffBtns).forEach(k => diffBtns[k].classList.toggle("active", k===diff));
    pillDiff.textContent = `Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ${DIFF[diff].label}`;
    refreshBoard();
  }

  function setSound(on){
    soundOn = on;
    pillSound.textContent = `Ø§Ù„ØµÙˆØª: ${soundOn ? "ØªØ´ØºÙŠÙ„" : "Ø¥ÙŠÙ‚Ø§Ù"}`;
    btnToggleSound.textContent = soundOn ? "ğŸ”Š Ø§Ù„ØµÙˆØª" : "ğŸ”‡ Ø§Ù„ØµÙˆØª";
  }

  function prettyMode(charKey){
    const d = DIFF[currentDiff];
    if(CHAR[charKey].mode === "add") return `Ø¬Ù…Ø¹ 0â€“${d.addMax}`;
    return `Ø¶Ø±Ø¨ 1â€“${d.mulMax}`;
  }

  // Generate non-repeating within a round
  function generateQuestions(charKey){
    const mode = CHAR[charKey].mode;
    const d = DIFF[currentDiff];
    const used = new Set();
    const qs = [];

    while(qs.length < Q_COUNT){
      let a,b,text,ans,key;

      if(mode === "add"){
        a = randint(0, d.addMax);
        b = randint(0, d.addMax);
        ans = a + b;
        const x = Math.min(a,b), y = Math.max(a,b);
        key = `add:${x}+${y}`;
        text = `${a} + ${b} = ØŸ`;
      } else {
        a = randint(1, d.mulMax);
        b = randint(1, d.mulMax);
        ans = a * b;
        const x = Math.min(a,b), y = Math.max(a,b);
        key = `mul:${x}Ã—${y}`;
        text = `${a} Ã— ${b} = ØŸ`;
      }

      if(used.has(key)) continue;
      used.add(key);
      qs.push({ text, answer: ans, key, userAns: null, correct: false, timeout:false });
    }
    return qs;
  }

  function startRound(charKey){
    currentChar = charKey;
    questions = generateQuestions(charKey);
    idx = 0;
    points = 0;

    mainTitle.textContent = `Ø¯ÙˆØ±: ${CHAR[charKey].name}`;
    mainDesc.textContent  = "Ø¬Ø§ÙˆØ¨ Ø¨Ø³Ø±Ø¹Ø© Ù‚Ø¨Ù„ Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„ÙˆÙ‚Øª!";

    whoName.textContent = `ğŸ‘¤ ${CHAR[charKey].name}`;
    whoDesc.textContent = `${CHAR[charKey].baseDesc} â€” ${prettyMode(charKey)} â€” Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ${DIFF[currentDiff].label}`;

    pillStatus.firstChild.textContent = `Ø¨Ø¯Ø£Ù†Ø§! Ø¯ÙˆØ± ${CHAR[charKey].name} ğŸš€ `;
    setView(quizView);
    renderQuestion();
  }

  function stopTimer(){
    if(timer){ clearInterval(timer); timer = null; }
  }

  function startTimer(){
    stopTimer();
    secLeft = SEC_PER_Q;
    updateTimerUI();
    timer = setInterval(() => {
      secLeft -= 1;
      updateTimerUI();

      // gentle ticks last 3 seconds
      if(secLeft <= 3 && secLeft > 0) soundTick();

      if(secLeft <= 0){
        stopTimer();
        // time's up -> next
        nextQuestion(false, true);
      }
    }, 1000);
  }

  function updateTimerUI(){
    secLeftEl.textContent = String(clamp(secLeft,0,SEC_PER_Q));
    const ratio = clamp(secLeft / SEC_PER_Q, 0, 1);
    barFill.style.transform = `scaleX(${ratio})`;
  }

  function renderQuestion(){
    wrongAttemptsThisQ = 0;
    const q = questions[idx];
    progressText.textContent = `Ø³Ø¤Ø§Ù„ ${idx+1} Ù…Ù† ${Q_COUNT}`;
    questionText.textContent = q.text;
    answerInput.value = "";
    answerInput.focus();
    startTimer();
  }

  function finishRound(){
    stopTimer();
    const name = CHAR[currentChar].name;
    resultTitle.textContent = `Ø§Ù†ØªÙ‡Øª Ø¬ÙˆÙ„Ø© ${name} ğŸ‰`;
    resultSub.textContent = `Ø¯Ø±Ø¬ØªÙƒ: ${points} Ù…Ù† 10 â€” Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ${DIFF[currentDiff].label}`;

    // Review list
    reviewBox.innerHTML = "";
    questions.forEach((q, i) => {
      const div = document.createElement("div");
      div.style.padding = "10px 12px";
      div.style.borderRadius = "14px";
      div.style.border = "1px solid rgba(20,40,60,.10)";
      div.style.background = "#ffffffb8";
      div.style.display = "flex";
      div.style.justifyContent = "space-between";
      div.style.alignItems = "center";
      div.style.gap = "12px";
      div.style.flexWrap = "wrap";

      const left = document.createElement("div");
      left.style.fontWeight = "1000";
      left.textContent = `${i+1}) ${q.text}`;

      const right = document.createElement("div");
      right.style.fontWeight = "1000";
      right.style.color = q.correct ? "#0d6f4a" : "#a61d2a";
      const ua = (q.userAns === null ? "â€”" : q.userAns);
      const tag = q.timeout ? "â±ï¸" : (q.correct ? "âœ…" : "âŒ");
      right.textContent = `${tag} Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${ua} | Ø§Ù„ØµØ­ÙŠØ­: ${q.answer}`;

      div.appendChild(left);
      div.appendChild(right);
      reviewBox.appendChild(div);
    });

    // Save (last + best + mode text)
    const st = loadState();
    if(!st.scores) st.scores = {};
    const entry = st.scores[currentChar] || {};
    const best = Math.max(entry.best ?? 0, points);

    st.scores[currentChar] = {
      last: points,
      best: best,
      diffLabel: DIFF[currentDiff].label,
      modeLabel: prettyMode(currentChar),
      updatedAt: Date.now()
    };
    st.updatedAt = Date.now();
    saveState(st);

    refreshBoard();

    pillStatus.firstChild.textContent = `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© ${name}: ${points}/10 âœ… `;
    if(points >= 8){
      showSpark("ğŸ† Ø£Ø³Ø·ÙˆØ±ÙŠ!");
      soundWin();
    } else if(points >= 6){
      showSpark("ğŸŒŸ Ù…Ù…ØªØ§Ø²!");
      soundOk();
    } else {
      showSpark("ğŸ’ª Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©!");
    }

    setView(resultView);
  }

  function nextQuestion(wasCorrect, wasTimeout=false){
    const q = questions[idx];

    if(wasTimeout){
      q.timeout = true;
      q.correct = false;
      showToast("warn", "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª â±ï¸ (Ø±Ø§Ø­ Ù†Ù†ØªÙ‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯Ù‡)");
      soundNo();
    } else if(wasCorrect){
      q.correct = true;
      points += 2;
      showToast("ok", "ØµØ­! +2 âœ…");
      soundOk();
    } else {
      q.correct = false;
      showToast("no", "Ø®Ø·Ø£ âŒ");
      soundNo();
    }

    idx += 1;
    if(idx >= Q_COUNT){
      finishRound();
    } else {
      renderQuestion();
    }
  }

  function submitAnswer(){
    if(!currentChar) return;

    const q = questions[idx];
    const val = answerInput.value.trim();
    const userAns = val === "" ? null : Number(val);

    // Save attempt
    q.userAns = userAns;

    if(userAns === q.answer){
      stopTimer();
      nextQuestion(true, false);
      return;
    }

    // Wrong answer: allow a second try if time remains
    wrongAttemptsThisQ += 1;
    if(wrongAttemptsThisQ < 2 && secLeft > 0){
      showToast("warn", "Ù‚Ø±ÙŠØ¨! Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© Ø¨Ø³Ø±Ø¹Ø© âœ¨");
      soundNo();
      answerInput.select();
      answerInput.focus();
      return;
    }

    // Otherwise move on
    stopTimer();
    nextQuestion(false, false);
  }

  function skipQuestion(){
    if(!currentChar) return;
    const q = questions[idx];
    q.userAns = null;
    stopTimer();
    nextQuestion(false, false);
  }

  function refreshBoard(){
    const st = loadState();
    const s = (st.scores || {});

    function fmt(key){
      const e = s[key];
      if(!e) return "â€”";
      return `Ø¢Ø®Ø±: ${e.last}/10 | Ø£ÙØ¶Ù„: ${e.best}/10`;
    }
    function badgeFmt(key){
      const e = s[key];
      if(!e) return "Ù„Ù… ÙŠÙ„Ø¹Ø¨";
      return `${e.last}/10 (Ø£ÙØ¶Ù„ ${e.best}/10)`;
    }

    scoreMoh.textContent  = fmt("mohammed");
    scoreAsia.textContent = fmt("asia");
    scoreSal.textContent  = fmt("salsabil");

    badgeMoh.textContent  = badgeFmt("mohammed");
    badgeAsia.textContent = badgeFmt("asia");
    badgeSal.textContent  = badgeFmt("salsabil");

    modeM.textContent = s.mohammed?.modeLabel || "â€”";
    modeA.textContent = s.asia?.modeLabel || "â€”";
    modeS.textContent = s.salsabil?.modeLabel || "â€”";

    // ranking by LAST result (not best), only if all have last
    const m = s.mohammed?.last;
    const a = s.asia?.last;
    const b = s.salsabil?.last;
    const allDone = [m,a,b].every(v => typeof v === "number");

    if(allDone){
      const arr = [
        { key:"mohammed", name:"Ù…Ø­Ù…Ø¯", score:m },
        { key:"asia", name:"Ø¢Ø³ÙŠØ©", score:a },
        { key:"salsabil", name:"Ø³Ù„Ø³Ø¨ÙŠÙ„", score:b },
      ].sort((x,y) => y.score - x.score);

      rankList.innerHTML = "";
      arr.forEach((it, i) => {
        const div = document.createElement("div");
        div.className = "rankItem";
        div.innerHTML = `
          <div style="display:flex;align-items:center;gap:10px">
            <div class="pos">${i+1}</div>
            <div>${it.name}</div>
          </div>
          <div>${it.score}/10</div>
        `;
        rankList.appendChild(div);
      });

      rankBox.classList.remove("hidden");
    } else {
      rankBox.classList.add("hidden");
      rankList.innerHTML = "";
    }

    // update pill info
    pillDiff.textContent = `Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ${DIFF[currentDiff].label}`;
    pillSound.textContent = `Ø§Ù„ØµÙˆØª: ${soundOn ? "ØªØ´ØºÙŠÙ„" : "Ø¥ÙŠÙ‚Ø§Ù"}`;
  }

  function goHome(){
    stopTimer();
    currentChar = null;
    questions = [];
    idx = 0;
    points = 0;

    mainTitle.textContent = "Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©";
    mainDesc.textContent = "Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ. ØªÙ‚Ø¯Ø± ØªØºÙŠÙ‘Ø± Ø§Ù„ØµØ¹ÙˆØ¨Ø© ÙˆØªØ´ØºÙ‘Ù„/ØªØ·ÙÙŠ Ø§Ù„ØµÙˆØª.";
    pillStatus.firstChild.textContent = "Ø¬Ø§Ù‡Ø²ÙŠÙ†ØŸ Ø§Ø®ØªØ± Ø´Ø®ØµÙŠØ© ÙˆØ§Ø¨Ø¯Ø£ ğŸ‘‡ ";
    setView(homeView);
  }

  function resetAll(){
    stopTimer();
    localStorage.removeItem(storageKey);
    refreshBoard();
    showSpark("âœ… ØªÙ… Ø§Ù„ØªØµÙÙŠØ±");
    pillStatus.firstChild.textContent = "ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ âœ… ";
    goHome();
  }

  // ========== Events ==========
  document.querySelectorAll(".char").forEach(el => {
    el.addEventListener("click", () => {
      // unlock audio on first interaction (best for mobile)
      ensureAudio();
      const key = el.getAttribute("data-char");
      startRound(key);
    });
  });

  Object.keys(diffBtns).forEach(k => {
    diffBtns[k].addEventListener("click", () => setDifficulty(k));
  });

  btnSubmit.addEventListener("click", submitAnswer);
  btnSkip.addEventListener("click", skipQuestion);
  btnBack.addEventListener("click", goHome);
  btnHome.addEventListener("click", goHome);
  btnReset.addEventListener("click", resetAll);

  btnToggleSound.addEventListener("click", () => {
    setSound(!soundOn);
    showSpark(soundOn ? "ğŸ”Š Ø§Ù„ØµÙˆØª Ø´ØºØ§Ù„" : "ğŸ”‡ Ø§Ù„ØµÙˆØª Ù…Ø·ÙÙŠ");
  });

  btnPlayAgain.addEventListener("click", () => {
    if(!currentChar){ goHome(); return; }
    startRound(currentChar);
  });

  btnToHome2.addEventListener("click", goHome);

  answerInput.addEventListener("keydown", (e) => {
    if(e.key === "Enter") submitAnswer();
  });

  // ========== Init ==========
  setSound(true);
  setDifficulty("easy");
  refreshBoard();
})();
</script>
</body>
</html>
